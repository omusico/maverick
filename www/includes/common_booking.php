<?php

$countryCodes = array(
	'Afghanistan' => '93',
	'Albania' => '355',
	'Algeria' => '213',
	'American Samoa' => '684',
	'Andorra' => '376',
	'Angola' => '244',
	'Anguilla' => '809',
	'Antigua' => '268',
	'Argentina' => '54',
	'Armenia' => '374',
	'Aruba' => '297',
	'Ascension Island' => '247',
	'Australia' => '61',
	'Australian External Territories' => '672',
	'Austria' => '43',
	'Azerbaijan' => '994',
	'Bahamas' => '242',
	'Barbados' => '246',
	'Bahrain' => '973',
	'Bangladesh' => '880',
	'Belarus' => '375',
	'Belgium' => '32',
	'Belize' => '501',
	'Benin' => '229',
	'Bermuda' => '809',
	'Bhutan' => '975',
	'British Virgin Islands' => '284',
	'Bolivia' => '591',
	'Bosnia and Hercegovina' => '387',
	'Botswana' => '267',
	'Brazil' => '55',
	'British V.I.' => '284',
	'Brunei Darussalm' => '673',
	'Bulgaria' => '359',
	'Burkina Faso' => '226',
	'Burundi' => '257',
	'Cambodia' => '855',
	'Cameroon' => '237',
	'Canada' => '1',
	'CapeVerde Islands' => '238',
	'Caribbean Nations' => '1',
	'Cayman Islands' => '345',
	'Cape Verdi' => '238',
	'Central African Republic' => '236',
	'Chad' => '235',
	'Chile' => '56',
	'China' => '86',
	'China-Taiwan' => '886',
	'Colombia' => '57',
	'Comoros and Mayotte' => '269',
	'Congo' => '242',
	'Cook Islands' => '682',
	'Costa Rica' => '506',
	'Croatia' => '385',
	'Cuba' => '53',
	'Cyprus' => '357',
	'Czech Republic' => '420',
	'Denmark' => '45',
	'Diego Garcia' => '246',
	'Dominca' => '767',
	'Dominican Republic' => '809',
	'Djibouti' => '253',
	'Ecuador' => '593',
	'Egypt' => '20',
	'El Salvador' => '503',
	'Equatorial Guinea' => '240',
	'Eritrea' => '291',
	'Estonia' => '372',
	'Ethiopia' => '251',
	'Falkland Islands' => '500',
	'Faroe (Faeroe) Islands (Denmark)' => '298',
	'Fiji' => '679',
	'Finland' => '358',
	'France' => '33',
	'French Antilles' => '596',
	'French Guiana' => '594',
	'Gabon' => '241',
	'Gambia' => '220',
	'Georgia' => '995',
	'Germany' => '49',
	'Ghana' => '233',
	'Gibraltar' => '350',
	'Greece' => '30',
	'Greenland' => '299',
	'Grenada/Carricou' => '473',
	'Guam' => '671',
	'Guatemala' => '502',
	'Guinea' => '224',
	'Guinea-Bissau' => '245',
	'Guyana' => '592',
	'Haiti' => '509',
	'Honduras' => '504',
	'Hong Kong' => '852',
	'Hungary' => '36',
	'Iceland' => '354',
	'India' => '91',
	'Indonesia' => '62',
	'Iran' => '98',
	'Iraq' => '964',
	'Ireland' => '353',
	'Israel' => '972',
	'Italy' => '39',
	'Ivory Coast' => '225',
	'Jamaica' => '876',
	'Japan' => '81',
	'Jordan' => '962',
	'Kazakhstan' => '7',
	'Kenya' => '254',
	'Khmer Republic (Cambodia/Kampuchea)' => '855',
	'Kiribati Republic (Gilbert Islands)' => '686',
	'Korea (South)' => '82',
	'Korea (North)' => '850',
	'Kuwait' => '965',
	'Kyrgyz Republic' => '996',
	'Latvia' => '371',
	'Laos' => '856',
	'Lebanon' => '961',
	'Lesotho' => '266',
	'Liberia' => '231',
	'Lithuania' => '370',
	'Libya' => '218',
	'Liechtenstein' => '423',
	'Luxembourg' => '352',
	'Macao' => '853',
	'Macedonia' => '389',
	'Madagascar' => '261',
	'Malawi' => '265',
	'Malaysia' => '60',
	'Maldives' => '960',
	'Mali' => '223',
	'Malta' => '356',
	'Marshall Islands' => '692',
	'Martinique (French Antilles)' => '596',
	'Mauritania' => '222',
	'Mauritius' => '230',
	'Mayolte' => '269',
	'Mexico' => '52',
	'Micronesia (F.S. of Polynesia)' => '691',
	'Moldova' => '373',
	'Monaco' => '33',
	'Mongolia' => '976',
	'Montserrat' => '473',
	'Morocco' => '212',
	'Mozambique' => '258',
	'Myanmar (former Burma)' => '95',
	'Namibia (former South-West Africa)' => '264',
	'Nauru' => '674',
	'Nepal' => '977',
	'Netherlands' => '31',
	'Netherlands Antilles' => '599',
	'Nevis' => '869',
	'New Caledonia' => '687',
	'New Zealand' => '64',
	'Nicaragua' => '505',
	'Niger' => '227',
	'Nigeria' => '234',
	'Niue' => '683',
	'North Korea' => '850',
	'North Mariana Islands (Saipan)' => '1 670',
	'Norway' => '47',
	'Oman' => '968',
	'Pakistan' => '92',
	'Palau' => '680',
	'Panama' => '507',
	'Papua New Guinea' => '675',
	'Paraguay' => '595',
	'Peru' => '51',
	'Philippines' => '63',
	'Poland' => '48',
	'Portugal (includes Azores)' => '351',
	'Puerto Rico' => '1 787',
	'Qatar' => '974',
	'Reunion (France)' => '262',
	'Romania' => '40',
	'Russia' => '7',
	'Rwanda (Rwandese Republic)' => '250',
	'Saipan' => '670',
	'San Marino' => '378',
	'Sao Tome and Principe' => '239',
	'Saudi Arabia' => '966',
	'Senegal' => '221',
	'Serbia and Montenegro' => '381',
	'Seychelles' => '248',
	'Sierra Leone' => '232',
	'Singapore' => '65',
	'Slovakia' => '421',
	'Slovenia' => '386',
	'Solomon Islands' => '677',
	'Somalia' => '252',
	'South Africa' => '27',
	'Spain' => '34',
	'Sri Lanka' => '94',
	'St. Helena' => '290',
	'St. Kitts/Nevis' => '869',
	'St. Pierre &(et) Miquelon (France)' => '508',
	'Sudan' => '249',
	'Suriname' => '597',
	'Swaziland' => '268',
	'Sweden' => '46',
	'Switzerland' => '41',
	'Syrian Arab Republic (Syria)' => '963',
	'Tahiti (French Polynesia)' => '689',
	'Taiwan' => '886',
	'Tajikistan' => '7',
	'Tanzania (includes Zanzibar)' => '255',
	'Thailand' => '66',
	'Togo (Togolese Republic)' => '228',
	'Tokelau' => '690',
	'Tonga' => '676',
	'Trinidad and Tobago' => '1 868',
	'Tunisia' => '216',
	'Turkey' => '90',
	'Turkmenistan' => '993',
	'Tuvalu (Ellice Islands)' => '688',
	'Uganda' => '256',
	'Ukraine' => '380',
	'United Arab Emirates' => '971',
	'United Kingdom' => '44',
	'Uruguay' => '598',
	'USA' => '1',
	'Uzbekistan' => '7',
	'Vanuatu (New Hebrides)' => '678',
	'Vatican City' => '39',
	'Venezuela' => '58',
	'Viet Nam' => '84',
	'Virgin Islands' => '1 340',
	'Wallis and Futuna' => '681',
	'Western Samoa' => '685',
	'Yemen' => '381',
	'Yemen Arab Republic (North Yemen)' => '967',
	'Zaire' => '243',
	'Zambia' => '260',
	'Zimbabwe' => '263',	
);



$extras = array(
	'LODGE' => array(
		'DORM' => array(
			array('img' => '/img/icon/svc_icon_free_wifi.png', 'name' => FREE_WIFI),
			array('img' => '/img/icon/svc_icon_towel_included.png', 'name' => LINEN_AND_TOWEL_INCLUDED),
			array('img' => '/img/icon/svc_icon_reading_lights.png', 'name' => READING_LIGHTS),
			array('img' => '/img/icon/svc_icon_lockers.png', 'name' => LOCKERS),
			array('img' => '/img/icon/svc_icon_smoke_fee_environment.png', 'name' => SMOKE_FREE_ENVIRONMENT),
			array('img' => '/img/icon/svc_icon_air_conditioning.png', 'name' => AIR_CONDITIONING),
			array('img' => '/img/icon/svc_icon_air_hair_dryer_in_bath.png', 'name' => HAIR_DRYER_IN_BATH)
		),
		'PRIVATE' => array(
			array('img' => '/img/icon/svc_icon_free_wifi.png', 'name' => FREE_WIFI),
			array('img' => '/img/icon/svc_icon_flat_screen_tv.png', 'name' => FLAT_SCREEN_TV),
			array('img' => '/img/icon/svc_icon_reading_lights.png', 'name' => READING_LIGHTS),
			array('img' => '/img/icon/svc_icon_smoke_fee_environment.png', 'name' => SMOKE_FREE_ENVIRONMENT),
			array('img' => '/img/icon/svc_icon_air_conditioning.png', 'name' => AIR_CONDITIONING),
			array('img' => '/img/icon/svc_icon_air_hair_dryer_in_bath.png', 'name' => HAIR_DRYER_IN_BATH),
			array('img' => '/img/icon/svc_icon_towel_included.png', 'name' => LINEN_AND_TOWEL_INCLUDED),
		),
		'APARTMENT' => array(
			array('img' => '/img/icon/svc_icon_free_wifi.png', 'name' => FREE_WIFI),
			array('img' => '/img/icon/svc_icon_flat_screen_tv.png', 'name' => FLAT_SCREEN_TV),
			array('img' => '/img/icon/svc_icon_reading_lights.png', 'name' => READING_LIGHTS),
			array('img' => '/img/icon/svc_icon_smoke_fee_environment.png', 'name' => SMOKE_FREE_ENVIRONMENT),
			array('img' => '/img/icon/svc_icon_air_conditioning.png', 'name' => AIR_CONDITIONING),
			array('img' => '/img/icon/svc_icon_air_hair_dryer_in_bath.png', 'name' => HAIR_DRYER_IN_BATH),
			array('img' => '/img/icon/svc_icon_towel_included.png', 'name' => LINEN_AND_TOWEL_INCLUDED),
		)
	),
	'HOSTEL' => array(
		'DORM' => array(
			array('img' => '/img/icon/svc_icon_free_wifi.png', 'name' => FREE_WIFI),
			array('img' => '/img/icon/svc_icon_towel_included.png', 'name' => LINEN_AND_TOWEL_INCLUDED),
			array('img' => '/img/icon/svc_icon_lockers.png', 'name' => LOCKERS),
			array('img' => '/img/icon/svc_icon_reading_lights.png', 'name' => READING_LIGHTS),
			array('img' => '/img/icon/svc_icon_no_bunk_beds.png', 'name' => NO_BUNK_BEDS),
			array('img' => '/img/icon/svc_icon_smoke_fee_environment.png', 'name' => SMOKE_FREE_ENVIRONMENT),
			array('img' => '/img/icon/svc_icon_air_hair_dryer_for_request.png', 'name' => HAIR_DRYER_FOR_REQUEST)
		),
		'PRIVATE' => array(
			array('img' => '/img/icon/svc_icon_free_wifi.png', 'name' => FREE_WIFI),
			array('img' => '/img/icon/svc_icon_reading_lights.png', 'name' => READING_LIGHTS),
			array('img' => '/img/icon/svc_icon_smoke_fee_environment.png', 'name' => SMOKE_FREE_ENVIRONMENT),
			array('img' => '/img/icon/svc_icon_cable_tv.png', 'name' => CABLE_TV),
			array('img' => '/img/icon/svc_icon_air_hair_dryer_for_request.png', 'name' => HAIR_DRYER_FOR_REQUEST),
			array('img' => '/img/icon/svc_icon_towel_included.png', 'name' => LINEN_AND_TOWEL_INCLUDED)
		)
	),
	'APARTMENTS' => array(
		'APARTMENT' => array(
			array('img' => '/img/icon/svc_icon_free_wifi.png', 'name' => FREE_WIFI),
			array('img' => '/img/icon/svc_icon_reading_lights.png', 'name' => READING_LIGHTS),
			array('img' => '/img/icon/svc_icon_smoke_fee_environment.png', 'name' => SMOKE_FREE_ENVIRONMENT),
			array('img' => '/img/icon/svc_icon_cable_tv.png', 'name' => CABLE_TV),
			array('img' => '/img/icon/svc_icon_air_hair_dryer_for_request.png', 'name' => HAIR_DRYER_FOR_REQUEST),
			array('img' => '/img/icon/svc_icon_towel_included.png', 'name' => LINEN_AND_TOWEL_INCLUDED)
		)
	)
);


function getExtrasHtml($location, $typeOfRoom) {
	global $extras;
	$extrasHtml = '';
	foreach($extras[strtoupper($location)][$typeOfRoom] as $oneExtra) {
		$extraImg = $oneExtra['img'];
		$extraName = $oneExtra['name'];
		$extrasHtml .=<<<EOT
                        <li>
                          <img width="52" height="51" src="$extraImg" title="$extraName" >
                          <div></div>
                        </li>

EOT;
	}
	return $extrasHtml;
}


function loadServices($link) {
	$services = array();
	$lang = getCurrentLanguage();
	$sql = "SELECT s.*, t.value AS title, d.value AS description , u.value AS unit_name FROM services s INNER JOIN lang_text t ON (s.id=t.row_id AND t.table_name='services' AND t.column_name='title' AND t.lang='$lang') INNER JOIN lang_text d ON (s.id=d.row_id AND d.table_name='services' AND d.column_name='description' AND d.lang='$lang') LEFT OUTER JOIN lang_text u ON (s.id=u.row_id AND u.table_name='services' AND u.column_name='unit_name' AND u.lang='$lang') ORDER BY s._order";
	$result = mysql_query($sql, $link);
	while($row = mysql_fetch_assoc($result)) {
		$services[$row['id']] = $row;
	}

	return $services;
}


function getBookingSummaryHtml($buttonText) {
	$bookingSummary = BOOKING_SUMMARY;
	$total = TOTAL;
	$extraServices = ADD_EXTRA_SERVICES;
	$chooseYourRoom = CHOOSE_YOUR_ROOM;
	$submitYourDetails = SUBMIT_YOUR_DETAILS;
	$noBookingFee = NO_BOOKING_FEE;
	$noCreditCardNeeded = NO_CREDIT_CARD_NEEDED;
	$allTaxIncluded = ALL_TAX_INCLUDED;
	$showBookingSummary = SHOW_BOOKING_SUMMARY;

	$changeDates = CHANGE_DATES;
	$checkinDate = CHECKIN_DATE;
	$checkoutDate = CHECKOUT_DATE;
	$chooseLocation = CHOOSE_LOCATION;
	$locationLodge = LOCATION_NAME_LODGE;
	$locationHostel = LOCATION_NAME_HOSTEL;
	$locationApartments = LOCATION_NAME_APARTMENTS;
	$checkAvailability = CHECK_AVAILABILITY;


	$fromDate = $_SESSION['from_date'];
	$toDate = $_SESSION['to_date'];

	$availabilityPage = getLocation() . '_available_rooms.php';
	$lodgeSelected = (getLocation() == 'lodge' ? ' selected' : '');
	$hostelSelected = (getLocation() == 'hostel' ? ' selected' : '');
	$apartmentsSelected = (getLocation() == 'apartments' ? ' selected' : '');

	$html = <<<EOT
	    <section id="booking-summary">
          <div class="bkSummary">
              <h1>$bookingSummary</h1>
              
              <ul class="details">
                <li class="rooms inactive" data-label="$chooseYourRoom">
                  $chooseYourRoom
                </li>
                <li class="services inactive" data-label="$extraServices">
                  $extraServices
                </li>
                <li class="contact inactive" data-label="$submitYourDetails">
                  $submitYourDetails
                </li>
              </ul>

              <div class="next">
                <h2>$total:</h2>
                <p class="total">€0</p>
                <p class="info" style="font-size: 110%;">$noBookingFee</p>
                <p class="info" style="font-size: 110%;">$noCreditCardNeeded</p>
                <p class="info" style="font-size: 110%;">$allTaxIncluded</p>

                <button type="submit">$buttonText</button>
              </div>

		  </div>

          <button type="button" class="bkSummarySwitch" style="display:none">$showBookingSummary</button>

		  <div class="FromToText" style="padding-left: 10px;color:">
		  $checkinDate: $fromDate<br>
		  $checkoutDate: $toDate
          </div>

            <div class="changeDates">
               <form action="$availabilityPage" method="GET" class='common-form'>
                <div class="dateChangerFader"><i class="fa fa-calendar"></i>$changeDates</div>  
                  <fieldset class="cdFields">
                    <div class="field date from clearfix">
                      <input type="date" class='cifrom from' id="from" name="from" value="$fromDate" placeholder='$checkinDate'>
                    </div>

                    <div class="field date to clearfix">
					  <input type="date" class='cito to' id="to" name="to" value="$toDate" placeholder='$checkoutDate'>
                    </div>

                    <div class="fake-select">
                      <span class="value">$chooseLocation</span>
                      <span class="open-select icon-down"></span>
                      <select name="location" class='cilocation'>
                      <option value="">$chooseLocation</option>
                        <option value="lodge"$lodgeSelected>$locationLodge</option>
                        <option value="hostel"$hostelSelected>$locationHostel</option>
                        <option value="apartments"$apartmentsSelected>$locationApartments</option>
                      </select>
                    </div>
                    
                      <div class="clearfix"></div>
                      <br>
                    <div class="submit">
                      <button onClick="RecheckAvailability('available_rooms.php');return false;">$checkAvailability</button>
                    </div>
                  </fieldset>
                
                </form>   
            </div>


            </section>

EOT;

	return $html;

}

function getBookedServices($services, $location) {
	$retVal = array();
	foreach($services as $serviceId => $service) {
		$occasions = 0;
		$key = 'service_' . $location . '_' . $serviceId;
		if(isset($_REQUEST[$key])) {
			$_SESSION[$key] = $_REQUEST[$key];
		}
		if(isset($_SESSION[$key])) {
			$occasions = $_SESSION[$key];
		}

		if($occasions > 0) {
			$title = $service['title'];
			$price = $service['price'] * $occasions;
			$serviceCurrency = $service['currency'];
			$unitName = $service['unit_name'];
			$retVal[] = array('title' => $title, 'occasion' => $occasions, 'price' => $price, 'currency' => $serviceCurrency, 'serviceId' => $serviceId, 'unit_name' => $unitName);
		}

	}
	return $retVal;
}

function showApartments() {
	return ($_SESSION['location'] == 'apartments');
}


function getFName($file) {
	$parts = explode('.', $file);
	return $parts[0];
}

function getFExt($file) {
	$parts = explode('.', $file);
	if(count($parts) > 1) {
		return $parts[1];
	} else {
		return '';
	}
}



?>
